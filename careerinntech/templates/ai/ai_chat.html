{% extends "base.html" %}

{% block content %}
<div id="aiRoot"
     style="
       position: relative;
       z-index: 99999;
       max-width: 800px;
       margin: 40px auto;
       color: white;
     ">

  <h2>ðŸ‘‹ Welcome to AI Career Bot</h2>

  <div id="chatMessages"
       style="
         height: 400px;
         overflow-y: auto;
         background: #0f172a;
         padding: 16px;
         border-radius: 10px;
         margin-bottom: 12px;
       ">
    <div><b>AI:</b> Ask me anything.</div>
  </div>

  <div style="display:flex;gap:10px;">
    <input id="chatInput"
           style="
             flex:1;
             padding:12px;
             border-radius:6px;
             pointer-events:auto;
           "
           placeholder="Type your question..." />

    <button id="sendBtn"
            type="button"
            style="
              padding:12px 20px;
              border-radius:6px;
              cursor:pointer;
              pointer-events:auto;
            ">
      Send
    </button>
  </div>

</div>

<script>
function sendMessage() {
  const input = document.getElementById("chatInput");
  const msg = input.value.trim();
  if (!msg) return;

  const box = document.getElementById("chatMessages");
  box.innerHTML += `<div class="msg user">You: ${msg}</div>`;
  input.value = "";

  fetch("/ai/chat/", {
    method: "POST",
    credentials: "same-origin",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body: `message=${encodeURIComponent(msg)}`
  })
  .then(async res => {
    const text = await res.text();   // ðŸ”¥ READ RAW RESPONSE
    box.innerHTML += `<div class="msg bot">RAW RESPONSE: ${text}</div>`;
    box.scrollTop = box.scrollHeight;
  })
  .catch(err => {
    box.innerHTML += `<div class="msg bot">JS ERROR: ${err}</div>`;
  });
}
</script>

{% endblock %}
